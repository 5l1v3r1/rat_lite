<!DOCTYPE html>
<html lang="en">
<head>
    <title>Simple-Web-Server html-file</title>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
</head>

<body>
    <script>
        function _arrayBufferToBase64(buffer) {
            var binary = '';
            var bytes = new Uint8Array(buffer, 16);
            var len = bytes.byteLength;
            $('#logsection').append('<br/>'+(len +16));
            for (var i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }
        function draw2(imgData, coords) {
            "use strict";
            $('#logsection').append('coords' + coords.X + ' ' + coords.Y + ' ' + coords.Width + ' ' + coords.Height);
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");

            var img = new Image();
            img.src = "data:image/jpeg;base64," + _arrayBufferToBase64(imgData);
            img.onload = function () {
                ctx.drawImage(img, coords.X, coords.Y);
            };
            img.onerror = function (stuff) {
                console.log("Img Onerror:", stuff);
            };

        }
        var receivedone = false;
        $(document).ready(function () {
            if ("WebSocket" in window) {

                var ws = new WebSocket("ws://127.0.0.1:8081/echo");
                ws.binaryType = 'arraybuffer';
                ws.onopen = function () {

                    $('#logsection').append('Socket Opened');

                };

                ws.onmessage = function (evt) {
                 
                        receivedone = true;
                        var data = new DataView(evt.data);

                        var imagerect = {
                            X: data.getInt32(0, true),
                            Y: data.getInt32(4, true),
                            Width: data.getInt32(8, true),
                            Height: data.getInt32(12, true)
                        }
                        draw2(evt.data, imagerect);
                    
                   

                };

                ws.onclose = function () {
                    $('#logsection').append('Connection is closed...');
                };
            }

            else {
                // The browser doesn't support WebSocket
                alert("WebSocket NOT supported by your Browser!");
            }
        });

    </script>

    <canvas id="myCanvas" height="1080" width="3840"></canvas>
    <div id="logsection"></div>

</body>
</html>
